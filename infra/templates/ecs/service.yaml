AWSTemplateFormatVersion: '2010-09-09'
Description: ECS Service

Parameters:
  ClusterName:
    Type: String
  TaskDefinitionArn:
    Type: String
  SubnetIds:
    Type: List<AWS::EC2::Subnet::Id>
  SecurityGroupId:
    Type: AWS::EC2::SecurityGroup::Id
  TargetGroupArn:
    Type: String

Resources:
  AppService:
    Type: AWS::ECS::Service
    Properties:
      Cluster: !Ref ClusterName
      TaskDefinition: !Ref TaskDefinitionArn
      LaunchType: FARGATE
      DesiredCount: 1
      HealthCheckGracePeriodSeconds: 60
      NetworkConfiguration:
        AwsvpcConfiguration:
          AssignPublicIp: ENABLED
          Subnets: !Ref SubnetIds
          SecurityGroups: [!Ref SecurityGroupId]
      LoadBalancers:
        - TargetGroupArn: !Ref TargetGroupArn
          ContainerName: app
          ContainerPort: 80
  
Outputs:
  ServiceName:
    Value: !Ref AppService
    Export:
      Name: !Sub "${AWS::StackName}-ServiceName"
